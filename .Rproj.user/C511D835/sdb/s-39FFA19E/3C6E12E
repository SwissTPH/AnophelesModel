{
    "collab_server" : "",
    "contents" : "---\ntitle: \"AnophelesModel Documentation\"\nauthor: \"Monica Golumbeanu, Olivier BriÃ«t, Clara Champagne, Jeanne Lemant, Barnabas Zogo, Maximilian Gerhards, Marianne Sinka, Nakul Chitnis, Melissa Penny, Emilie Pothin, Tom Smith\"\ndate: \"`r Sys.Date()`\"\noutput: \n    rmarkdown::html_vignette:\n        fig_caption: yes\n        toc: true\nvignette: >\n  %\\VignetteIndexEntry{AnophelesModel Documentation}\n  %\\VignetteEngine{knitr::rmarkdown}\n  %\\VignetteEncoding{UTF-8}\nbibliography: references.bib\n---\n\n<style>\np.caption {\n  font-size: 0.85em;\n  font-style: italic;\n  color: grey\n}\n</style>\n\n\n```{r setup, include = FALSE}\nknitr::opts_chunk$set(\n  echo = TRUE,\n  collapse = TRUE,\n  comment = \"#>\"\n)\n```\n\n## Introduction\nThe `AnophelesModel` package can be used to parameterize a model of the\nmosquito feeding cycle using data about mosquito bionomics \n(entomological characteristics) and biting \npatterns, as well as human activity and intervention effects. The different \ntypes of data have been extracted from field studies and are included in \nthe package. The model infers the species-specific impact of various\nvector control interventions on the vectorial capacity. The package can be used \nto compare the impact of interventions for different mosquito species and to \ngenerate parameterizations for the entomological and vector control components \nof more complex models of malaria transmission dynamics.\n\nThe `AnophelesModel` package is based on a state transition model \nof the feeding dynamics of a mosquito population biting a population of \nhosts defined in [@Chitnis2008]. The model consists of a system of three \ndifference equations\ndescribing the dynamics in the numbers of not-infected, infected, and infective\nmosquitoes, respectively. The transitions between the individual steps of the \ncycle for a host *i* are modeled through probabilities and \nsummarized as follows:\n\n```{r, echo=FALSE, results='asis'}\nDiagrammeR::grViz(\"digraph {\n  graph [layout = dot, rankdir = LR]\n  \n  node [shape = circle, fixedsize=TRUE, fontsize=7]        \n  rec1 [label = <Host<BR/>seeking>]\n  rec2 [label = <Host<BR/>found>]\n  rec3 [label = <Fed>]\n  rec4 [label = <Resting>]\n  rec5 [label = <Ovipositing>]\n  \n  # edge definitions with the node IDs\n  rec1 -> rec2 [label= <P<SUB>Ai</SUB><BR/> >,fontsize=7]\n  rec2 -> rec3 [label= <P<SUB>Bi</SUB><BR/> >,fontsize=7]\n  rec3 -> rec4 [label= <P<SUB>Ci</SUB><BR/> >,fontsize=7]\n  rec4 -> rec5 [label= <P<SUB>Di</SUB><BR/> >,fontsize=7]\n  rec5 -> rec1 [label= <P<SUB>Ei</SUB><BR/> >,fontsize=7]\n  }\",\n  width = 700)\n```\n\nThese probabilities (represented by the arrows in the diagram above) \nare in turn affected by mosquito ecology, human behavior \nand interventions as described in the following sections of this vignette. \n\nThe present document provides information about the various use-cases of the\npackage with examples. First, it provides an overview of the general \nanalysis workflow. Next, it presents the contents of the\npackage database and its data objects. Finally, it provides more detailed \nexample use cases of the package functions. These examples include how to \nparameterize the embedded entomological model and evaluate the impact of various\nvector control interventions for different mosquito species and geographical \nlocations. In addition, examples are shown about how to produce formatted \ninputs for downstream analyses with \nthe [OpenMalaria](https://github.com/SwissTPH/openmalaria/wiki) [@Smith2006]\nindividual-based model of malaria transmission dynamics.\n\n## General workflow\nWith the main `AnophelesModel()` package function, the user can run in one go \nthe main analysis steps for parameterizing the model of the \nmosquito feeding cycle [@Chitnis2008]\nand estimate the reduction on the vectorial capacity for various vector control \ninterventions. These steps are summarized in the diagram below, alongside the \ncorresponding functions:\n```{r, echo=FALSE, results='asis'}\nDiagrammeR::grViz(\"digraph {\n  graph [layout = dot, rankdir = LR]\n  \n  node [shape = rectangle]        \n  rec1 [label = <Define entomological parameters <BR/><B>def_vector_params()</B>>]\n  rec2 [label = <Define mosquito and human activity patterns <BR/><B>def_activity_patterns()</B>>]\n  rec3 [label = <Define human host parameters <BR/><B>def_host_params()</B>>]\n  rec4 [label = <Parameterize entomological model <BR/><B>build_model_obj()</B>>]\n  rec5 [label = <Define interventions effects <BR/><B>def_interventions_effects()</B>>]\n  rec6 [label = <Calculate impact on vectorial capacity <BR/><B>calculate_impact()</B>>]\n  \n  # edge definitions with the node IDs\n  rec1 -> rec4 \n  rec2 -> rec4 \n  rec3 -> rec4\n  rec4 -> rec6\n  rec5 -> rec6\n  }\",\n  width = 720)\n```\n\nThe user can directly run the `AnophelesModel()` function as an initial test \nrun with a default analysis. By default, the `AnophelesModel()` function \nperforms the above steps considering \nthe parameters for *An. gambiae* in a Kenyan setting and with default activity \npatterns for mosquitoes and humans. It calibrates the entomological model,\nestimates the impact of indoor residual spraying (IRS), long-lasting \ninsecticide-treated nets (LLINs) and house screening, then plots the average \nvectorial capacity for a range of intervention coverages:\n```{r, dpi=150, fig.cap=\"Output figure generated with the standard call of the AnophelesModel() function\"}\n# load the AnophelesModel package\nlibrary(AnophelesModel)\n\n# call main function with default values\nresults_gambiae = AnophelesModel()\n```\n\nIn the section [Estimating the impact of vector control interventions], \nwe describe in detail how the user can access the \nfunctionalities of the package to customize the \ncall to this function or set up their own workflow to run the \nanalysis within the settings of interest.\n\n## AnophelesModel database \nThe package includes a comprehensive, curated database describing mosquito,\nhuman and intervention characteristics extracted after processing publicly\navailable field data and organized into multiple data objects.\nPrecisely, these objects include entomological (or bionomics) parameters\ncharacterizing various *Anopheles* species, their transitions in \nthe mosquito feeding cycle,\nactivity cycles of humans and mosquitoes, as well as parameters \nestimated from experimental hut studies describing\nthe effects of various interventions.\nThese parameters are used together within the entomological model included in\nthe package to estimate the impact of interventions on the vectorial capacity.\nAll the data objects are directly accessible to the user\nafter loading the `AnophelesModel` package. \n\n### Host-specific entomological parameters\n\nThe entomological model in the `AnophelesModel` package considers three classes\nof hosts (denoted with subscript i): humans protected by interventions, \nnon-protected humans,\nand animal hosts. Each type of host determines specific transition probabilities\nbetween the consecutive stages of the mosquito feeding cycle\n(e.g., interventions such as nets will affect the probability of mosquito\nfeeding on protected humans). The object `host_ent_param`\nin the package database contains, in absence of interventions, for human\nand animal hosts, default probabilities that a mosquito\ncompletes the consecutive stages of the feeding cycle in one night,\nconditional on having reached each stage:\n\n* `PBi`: Probability that a mosquito bites the host\n* `PCi`: Probability that a mosquito finds a resting place after biting\n* `PDi`: Probability that a mosquito survives the resting phase\n* `PEi`: Probability that a mosquito lays eggs and returns to host-seeking\n* `Kvi`: Proportion of susceptible mosquitoes that become infected after biting\n\nThe values of the different probabilities in absence of interventions \nare those proposed by [@Chitnis2008] and [@briet2019]. \nThe `host_ent_param` object can be directly \nused after loading the `AnophelesModel` package: \n```{r}\n# Print the object\nhost_ent_param\n```\n\n### Mosquito bionomics\n\nThe object `vec_ent_param` contains bionomic parameterizations for\n57 _Anopheles_ mosquito species and 17 complexes (families of species). \nThese parameters have been estimated using \na Bayesian hierarchical model (Lemant et al, in preparation) accounting for \nthe phylogeny of \nthe _Anopheles_ genus and informed by previously published entomological data \n[@Massey2016], [@briet2019]. Below, we provide an exhaustive list of these \nparameters, their names reflecting the notations used in [@Chitnis2008]:\n\n* `species_name`: name of the mosquito species\n* `M`: parous rate (proportion of host seeking mosquitoes that have laid \neggs at least once)\n* `M.sd`: standard deviation of the parous rate \n* `Chi`: human blood index (proportion of mosquito blood meals obtained \nfrom humans)\n* `A0`: sac rate (proportion of mosquitoes who laid eggs the same day)\n* `A0.sd`: standard deviation of the sac rate\n* `zeta.3`: relative availability of different non-human hosts\n* `td`: proportion of a day that a mosquito actively seeks a host\n* `tau`: time required for a mosquito that has encountered a host to return to \nhost seeking\n* `ts`: duration of the extrinsic incubation period (time required for \nsporozoites to develop in mosquitoes)\n* `endophily`: proportion of indoor resting mosquitoes\n* `endophily.sd`: standard deviation of the proportion of indoor \nresting mosquitoes\n* `endophagy`: proportion of indoor feeding mosquitoes\n* `endophagy.sd`: standard deviation of the proportion of indoor \nfeeding mosquitoes\n\nThe `vec_ent_param` object is available upon loading the `AnophelesModel` \npackage and can be directly used:\n```{r}\n# print the first entries of the vec_ent_param object\nhead(vec_ent_param)\n```\nFor example, to retrieve the parameters for *Anopheles albimanus*:\n```{r}\nvec_ent_param[vec_ent_param$species_name == \"Anopheles albimanus\", ]\n```\n\n### Human and mosquito activity patterns\nThe table `activity_patterns` contains mosquito biting patterns as well as \nhuman sleeping activity information extracted from [@Sherrard-Smith15086] and\n[@briet2019]. Each entry has the following attributes:\n\n* `id`: entry ID\n* `species`: can be \"Homo sapiens\" when the entries reflect human activity, \nor names of mosquito species (e.g., \"Anopheles gambiae\") for mosquito \nbiting patterns\n* `sampling`: can be one of the following:\n    + `IND`: for entries representing the proportion of humans indoors\n    + `BED`: for entries representing the proportion of humans in bed\n    + `HBI`: for entries representing the proportion of indoors human \n    biting\n    + `HBO`: for entries representing the proportion of outdoors human \n    biting\n    + `ABO`: for entries representing the proportion of outdoors \n    animal biting\n    + `HB`: for entries corresponding to the proportion of human biting\n* `country`: country where the measurements were taken\n* `site`: name of the geographical site where the measurements were taken\n* `hour`: hour of the day for which the sampling is reported, ranging from 4pm \nuntil 8am, format: hh:mm_hh:mm (e.g., 16:00_17:00)\n* `value`: measurement value\n\nThe object can be directly examined and its components\nretrieved for various purposes. For example, to retrieve all the human \nactivity patterns collected from Kenya:\n```{r}\nselect_idx = activity_patterns$species == \"Homo sapiens\" &\n                                  activity_patterns$country == \"Kenya\"\nKenya_human_rhythms = activity_patterns[select_idx,]\nhead(Kenya_human_rhythms)\n```\nA pattern of interest can then be selected and displayed, for example:\n```{r, dpi=150, fig.cap=\"Example of human activity patterns in Rachuonyo, Kenya. The proportion of humans indoors (labeled IND) out of the total human population is displayed.\"}\nlibrary(ggplot2)\nRachuonyo_human_rhythms = Kenya_human_rhythms[which(Kenya_human_rhythms$id == 2),]\nlabels = substr(unique(Rachuonyo_human_rhythms$hour), 1, 5)\nRachuonyo_human_rhythms$hour = factor(labels, levels = labels )\nggplot(Rachuonyo_human_rhythms, aes(x=hour, y=value, group=site)) +\n    theme_light() + theme_linedraw() + theme_bw(base_size = 5) +\n    theme(legend.position = \"bottom\") +\n    geom_line(size=0.5) + \n    scale_x_discrete(name = \"Time of the day (hh.mm)\")+ \n    guides(color = guide_legend(nrow = 2,byrow = TRUE)) +\n    labs(title = \"Proportion of humans indoors in Rachuonyo, Kenya\", fill=\"\",\n         x=\"Time\", y=\"Activity\")\n```\n\nAnother example extracting all the available biting behavior for \n*Anopheles gambiae* in Kenya:\n```{r}\nselect_idx = activity_patterns$species == \"Anopheles gambiae\" &\n                                  activity_patterns$country == \"Kenya\"\nKenya_gambiae_biting = activity_patterns[select_idx,]\nhead(Kenya_gambiae_biting)\n```\n\n### Intervention parameters \nThe `AnophelesModel` package includes parameterisations for estimating the \neffects of various vector control interventions. These effects include\nreducing host availability, killing mosquitoes over time since spraying,\ninsecticidal and deterrent effects as functions of insecticide content. \nThe interventions modeled in the package consist of different types \nof long lasting insecticide treated nets (LLINs), \nindoor residual spraying (IRS), and house screening. All the parameters for \ncalculating these effects are provided within the `interventions_param` \nobject which consists of three components, namely:\n\n* `interventions_param$interventions_summary`: an overview and general \ninformation for all available intervention parameterisations; this includes \ninformation about the active agent (insecticide) used, the \nmosquito species for which the effects were assessed in the experimental trials, \nthe duration of the intervention and details about the method and references\n* `interventions_param$LLINs_params`: an object including parameterisations \nfor various types of LLINs\n* `interventions_param$IRS_params`: a table containing estimated insecticide \ndecay for various types of IRS\n\nThe effects of LLINs are parameterized in terms of effectiveness in \nreducing the availability of humans, and both pre- and post-prandial killing \nof mosquitoes respectively. The effects are based on estimates from \nexperimental hut studies from [@randriamaherijaona2015]. The decay of these \neffects over time, in terms of attrition, use, physical and chemical integrity \nis parameterized through a series of logistic models described in [@briet2013], \n[@briet2019], and [@briet2020] using the data of President Malaria Initiative \n(PMI) net durability studies (7 countries, 8 net types, 23 combinations in all), \nand also from [@morgan2015]. The object `interventions_param$LLINs_params` \ncontains all this information and is composed of three tables: \n\n* `interventions_param$LLINs_params$model_coeff`: values for coefficients of \nregression models estimating LLINs effects; these models have been defined in \n[@briet2013], [@briet2019] and [@briet2020]\n* `interventions_param$LLINs_params$insecticide_c`: insecticide content for \nvarious types of nets summarized in [@briet2020]\n* `interventions_param$LLINs_params$durability_estim`: information about the \ndurability of LLINs (holed area, survival) across time in different \ngeographical locations also summarized in [@briet2020].\n\nSimilarly, for IRS, a table with time series of effects in reducing human \navailability and killing of mosquitoes as well as parameters describing \ndecay of effects over time is provided in `interventions_param$IRS_params`. \n\nThe parameterization for House screening is based \non the estimates from [@kirby2009] and described in [@briet2019], assuming a \nhouse entry reduction of 59%.\n\nThe data objects for interventions described above are directly accessible upon \nloading the `AnophelesModel` package. For example, for obtaining an overview\nof all LLINs interventions provided with the `AnophelesModel` package:\n\n```{r}\nprint(interventions_param$interventions_summary[which(interventions_param$interventions_summary$Intervention == \"LLINs\"),])\n```\n\n### Functions querying the package database\n\nThe package additionally contains helper functions for listing an overview \nof the different data objects to help the user populate the input arguments of \nthe key functions in the general workflow (e.g., for the `AnophelesModel()` \nfunction). These are:\n\n* `list_all_species()`: prints all the mosquito species for which bionomic \nparameters are provided in the package database\n* `list_activity()`: prints all the available activity patterns \n* `list_interventions()`: prints the available vector control interventions \n* `list_intervention_models()`: prints the available intervention \nparameterisation IDs\n* `get_net_types()`: prints the available net types and the countries where \nthe studies have been conducted \n\nFurthermore, the package allows extracting more specific information about the \ndurability of different types of LLINs such as holed area, survival and decay. \nThese parameteres were estimated in the PMI net durability studies.\n\nFor example, to retrieve the decay characteristics \nfor the DuraNet LLIN in Kenya:\n```{r}\n# load the necesary packages\nlibrary(reshape)\n\nDuraNet = get_net_decay(net_type = \"DuraNet\", country = \"Kenya\", insecticide_type = \"DuraNet\", n_ips = 100, duration = 3)\n```\nThen, to plot these characteristics :\n```{r, fig.show='hold'}\nlibrary(ggpubr)\n# Plot the survival\nggplot(DuraNet, aes(x=time, y=survival)) + geom_point() +\n    theme_light() + theme_linedraw() + theme_bw() + ggtitle(\"Survival of the net\")\n\n# Plot the log of the holed area\nggplot(DuraNet, aes(x=time, y=logHoles)) + geom_point() +\n    theme_light() + theme_linedraw() + theme_bw() + ggtitle(\"Log holed area\")\n\n# Plot the insecticide content\nggplot(DuraNet, aes(x=time, y=insecticideContent)) + geom_point() +\n    theme_light() + theme_linedraw() + theme_bw() + ggtitle(\"Insecticide decay\")\n```\n\n## Estimating the impact of vector control interventions\n\nThe mosquito bionomics, feeding cycle transitions, \nactivity patterns and intervention effects accessible from \nthe `AnophelesModel` database can be used to parameterise the model of \nthe mosquito feeding cycle\nand estimate the impact of interventions on the vectorial capacity.\n\n### Step 1: Defining entomological parameters\n\nTo define the mosquito specific entomological parameters in absence of \ninterventions, the user can either \nselect existing parameterisations from the `AnophelesModel` database, or \nprovide a set of custom values. For example, to choose an existing \nparameterisation for *Anopheles nili*:\n\n```{r}\nnili_ent_params = def_vector_params(mosquito_species = \"Anopheles nili\")\nhead(nili_ent_params)\n```\n\nTo use a different parameterisation, first all the entomological parameter values need \nto be provided in a data frame with the same column names \nas the `vec_ent_param` object:\n```{r}\n# Use own parameterisation\nspecies_name = \"Anopheles example\"\nM = 0.623\nM.sd = 0\nChi = 0.939\nA0 = 0.313\nA0.sd = 0\nzeta.3 = 1\ntd = 0.33\ntau = 3\nts = 10\nto = 5\nendophily = 1\nendophily.sd = 0\nendophagy = 1\nendophagy.sd = 0\ncustom_ent_params_table = as.data.frame(cbind.data.frame(species_name, M, M.sd, Chi,\n                                A0, A0.sd, zeta.3, td,\n                                tau, ts, to, endophily, endophily.sd, endophagy, endophagy.sd))\n```\nThen, the data frame is provided to the function defining the vector parameters:\n```{r}\ncustom_ent_params = def_vector_params(mosquito_species = species_name, vector_table = custom_ent_params_table)\nhead(custom_ent_params)\n```\n\n### Step 2: Defining host-specific entomological parameters\nObjects for host-specific entomological parameters (e.g., biting of human \nversus animal hosts, for details or other parameters see section \n[Host-specific entomological parameters]) in absence of interventions \ncan be defined in a similar way as \nfor the mosquito bionomics. To choose the default parameterisation \nfrom [@Chitnis2008]:\n```{r}\ndefault_host_params = def_host_params()\nprint(default_host_params)\n```\n\nFor using a different, custom parameterisation, first we need to build a \ndata frame with the same structure as `host_ent_params`:\n```{r}\nspecies_name = \"Anopheles example\" \nhost = c(\"human\", \"animal\") \nPBi = c(0.67, 0.44)\nPCi = c(0.33, 0.434)\nPDi = c(0.647, 0.344)\nPEi = c(0.672, 0.214)\nKvi = c(0.52, 0.314)\ncustom_params_tab = cbind.data.frame(species_name, host, PBi, PCi, PDi, PEi, Kvi)\n```\nAfterwards, we can provide this data frame to the relevant function for defining \nthe host parameters:\n```{r}\ncustom_host_params = def_host_params(mosquito_species = species_name, host_table = custom_params_tab)\nprint(custom_host_params)\n```\n\n### Step 3: Defining mosquito and human activity patterns\nTo facilitate definition of human and mosquito activity patterns, the \n`AnophelesModel` package comes with inbuilt default values for \n_Anopheles gambiae_ in Kenya and _Anopheles albimanus_ in Haiti. \nThe user can choose other patterns from the package database (344 entries) by \nusing the entry ID of each time series (`id` column of object \n`activity_patterns`). Furthermore, customized patterns can be defined by \ndirectly providing the time series values. Here are some examples for \nthese different use cases:\n\nTo use default activity patterns from Kenya (human activity measured in the \nRachuonyo and Rarieda districts):\n```{r}\nactivity_p = def_activity_patterns(activity = \"default_Anopheles_gambiae\")\nprint(activity_p)\n```\n\nTo select activity patterns from the database based on the entry IDs for \n*Anopheles arabiensis* in Kenya, Ahero disctrict:\n```{r}\nactivity_list = NULL\nactivity_list$HBI = 34\nactivity_list$HBO = 165\nactivity_list$humans_indoors = 4\nactivity_list$humans_in_bed = 24\nactivity_p2 = def_activity_patterns(activity_list)\nprint(activity_p2)\n```\n\nTo use custom activity patterns by specifying the different time series, for\nexample for *An. albimanus* in Haiti available from [@briet2019]:\n```{r}\n# Briet et al 2019, Table S5. Biting rhythm of An. albimanus in Haiti, Dame Marie\nHBI = c(0.22, 0.21, 0.22, 0.10, 0.13, 0.17, 0.08, 0.12, 0.03, 0.12, 0.17, 0.18, 0.25)\nHBO = c(0.25, 0.35, 0.37, 0.33, 0.36, 0.32, 0.13, 0.14, 0.09, 0.15, 0.36, 0.23, 0.25)\n# Human activity in Haiti from Briet et al 2019, Knutson et al. 2014\nhumans_in_bed = c(5.628637, 14.084496, 28.558507, 47.761203, 67.502964, 83.202297, 92.736838, 96.734455, 96.637604, 92.983136, 85.264515, 73.021653, 57.079495)/100 \nhumans_indoors = c(5.628637, 14.084496, 28.558507, 47.761203, 67.502964, 83.202297, 92.736838, 96.734455, 96.637604, 92.983136, 85.264515, 73.021653, 57.079495)/100 \ncustom_params = as.data.frame(cbind(HBI, HBO, humans_indoors,humans_in_bed ))\ncustom_activity_obj = def_activity_patterns(custom_params)\nprint(custom_activity_obj)\n```\n\n### Step 4: Initializing the entomological model\nOnce the vector, host and activity parameters have been defined, the \nentomological model can be initialized and calibrated accordingly.\nIn this step, the death rate and the availability to mosquitoes \nfor each host type are estimated. For a description of how these two \nparameters are estimated, see [@Chitnis2008].\n\nFirst, the sizes of the host and mosquito populations need to be defined:\n```{r}\n# Define size of the host and mosquito population \nhost_pop = 2000\nvec_pop = 10000\n```\n\nThen, to initialize the entomological model and build the model object:\n```{r}\nmodel_params = build_model_obj(custom_ent_params, default_host_params, custom_activity_obj, host_pop)\n# Print the calculated mosquito death rate\nprint(model_params$host_params$muvA)\n# Print the estimated availability to mosquitoes for each host type\nprint(model_params$host_params$alphai)\n```\n\n### Step 5: Defining interventions effects\nIn the `AnophelesModel` package, the interventions and their characteristics \nare specified through a list of intervention objects. A detailed description of\nhow the intervention objects are specified can be obtained by using the command \n`?def_interventions_effects`. To facilitate definition of these objects, \nthe package contains a list of intervention object examples \nfor each intervention type included in the `intervention_obj_examples` list. \n\nThe `intervention_obj_examples` list contains three examples of interventions :\nLLIN, IRS and House screening, respectively: \n```{r}\nprint(intervention_obj_examples)\n```\nExcept for the house screening where only the `id` and `description` attributes \nare required, to use the IRS and LLIN interventions included in the package, \nthe user needs to \nprovide the parameterisation ID (e.g., LLINs01, IRS01). A list of all package\nintervention parameterisations and their IDs can be obtained with the \n`list_intervention_models()` command.\nThe examples from `intervention_obj_examples` can be adapted to the user's \nneeds to pick other available parameterisations and intervention \ncharacteristics available within the package. For example, to select a \ndifferent IRS parameterisation, we can modify the `parameterisation` attribute \nof the IRS example:\n```{r}\nnew_IRS = intervention_obj_examples$IRS_example\nnew_IRS$description = \"Permethrin IRS\"\nnew_IRS$parameterisation = \"IRS16\"\n```\nthen we can concatenate the new intervention object to the list with \nintervention examples:\n```{r}\nnew_intervention_list = c(intervention_obj_examples, list(new_IRS = new_IRS))\n```\n\nOnce the intervention parameterisations have been defined, \nthe user needs to specify the intervention deployment coverages and a number of \ntime points. The duration of each intervention will be evenly split across the \ntime points and the intervention effects will be calculated at each time point.\n```{r}\nlist_interv = new_intervention_list\ncoverages = c(seq(0, 1, by = 0.1))\nn_ip = 100\n# Calculate the intervention effects:\nintervention_vec = def_interventions_effects(list_interv, model_params, n_ip)\n```\n\nThe effects of the interventions are adjusted according to indoor and outdoor \nhuman exposure to mosquitoes. The user can calculate the human exposure \nparameters using the following function:\n``` {r}\nin_out_exp = get_in_out_exp(activity_cycles = custom_activity_obj, vec_p = custom_ent_params)\nprint(in_out_exp)\n```\n\n### Step 6: Calculating intervention impact on vectorial capacity\nOnce all the intervention effects have been defined, their impact on the \nvectorial capacity can be estimated (using equation 20 from [@Chitnis2008]) :\n```{r, dpi=150, fig.cap=\"Output figure with the impact on the vectorial capacity for different species\"}\nimpacts = calculate_impact(intervention_vec, coverages, model_params,\nvec_pop, n_ip)\n```\nThe resulting vectorial capacity is calculated and aggregated across the \npreviously-specified time points which are uniformly-distributed across the \nduration of an \nintervention. To display the average vectorial capacity for various coverages:\n```{r, dpi=150, fig.cap=\"Impact of interventions on vectorial capacity.\"}\np = plot_impact_species(impacts, \"VC_red\")\nplot(p)\n```\n\nThe variability in the entomological parameters for each mosquito species can \nbe accounted for when calculating the impact of interventions on the vectorial \ncapacity. To do so, the standard deviation values of the entomological \nparameters (namely parameters `M.sd`, `A0.sd`, `endophily.sd` and `endophagy.sd` \nin the `vec_ent_param` object) \nare used to create a confidence interval defined as the mean value \n+/- two standard deviations. Using latin hypercube sampling [@stein1987], \na set of samples are uniformly drawn from the \nmulti-dimensional parameter space defined by the confidence intervals. Then, \nthe average vectorial capacity is computed for each of these samples and the \nresulting confidence interval for the vectorial capacity is represented by the \nmean value +/- two standard deviations. This sampling-based approach is \nincluded in the `calculate_impact_var()` function to \nestimate the confidence interval for the reported mean vectorial capacity. \nIn the example below, in the interest of execution time, only 10 samples have \nbeen used to estimate the confidence intervals of the vectorial capacity:\n```{r, dpi=150, fig.cap=\"Impact of interventions on vectorial capacity including the variability in the entomological parameters specific to the mosquito species.\"}\nimpact_gambiae = calculate_impact_var(mosquito_species = \"Anopheles gambiae\",\n                                        activity_patterns = \"default_Anopheles_gambiae\",\n                                        interventions = intervention_vec,\n                                        n_sample_points = 10,\n                                        plot_result = FALSE)\nplot_impact_var(\"Anopheles gambiae\", impact_gambiae)\n```\n\n## Generating vector parameterisations for OpenMalaria\nThe package `AnophelesModel` can be used to create XML snippets containing\nparameterisations for the entomology and generic vector control interventions \n(GVI) components of OpenMalaria experiments. \nThese snippets can then be incorporated in the base \nXML files describing the setup for OpenMalaria individual-based simulations.\nThere are two main categories of XML snippets that can be generated with the \npackage:\n\n* `<mosq>` and `<nonHumanHosts>` snippets containing entomological parameters\n* `<GVI>` snippets with parameters describing the effects of interventions\n\nFor example, to generate the `<mosq>` and `<nonHumanHosts>` snippets \nfor *Anopheles nili*:\n```{r}\nentomology_xml = get_OM_ento_snippet(nili_ent_params, default_host_params)\nprint(entomology_xml)\n```\n\nTo generate the `<GVI>` snippets with deterrency, pre- and post-prandial effects\nof interventions, a set of 7 decay functions are fitted to the time series with \nintervention effects calculated previously with `def_interventions_effects()` \nand the best fit is chosen. The package also produces visualizations of the \ndifferent decay fits. For a detailed description of the fitted decay functions, \ncheck the [description in the OpenMalaria wiki](https://github.com/SwissTPH/openmalaria/wiki/ModelDecayFunctions).\n```{r, dpi=150}\n\nGVI_snippets = get_OM_GVI_snippet(\"Anopheles example\", impacts$interventions_vec$LLINs_example,\n                    100, GVI_file = \"\", file_append = FALSE, plot_f = TRUE)\n```\n\n## References\n\n\n",
    "created" : 1634304258316.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "717399129",
    "id" : "3C6E12E",
    "lastKnownWriteTime" : 1635282713,
    "last_content_update" : 1635282713,
    "path" : "~/Documents/GitRepos/anophelesmodel2/dev_AnophelesModel/AnophelesModel/vignettes/AnophelesModel.Rmd",
    "project_path" : "vignettes/AnophelesModel.Rmd",
    "properties" : {
        "last_setup_crc32" : ""
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}