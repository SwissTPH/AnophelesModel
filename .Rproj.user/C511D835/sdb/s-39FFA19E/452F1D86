{
    "collab_server" : "",
    "contents" : "# calculate_Pii.r\n# Implements the Killeen et al (2006) calculations for maximum proportion of exposure (pii) \n# averted by bednets\n# written by Tom Smith December 2016\n\ncalculate_Pii<-function(IndoorL,OutdoorL,Percent_in_bed=\n      c(0,0,3.768844221,69.34673367,99.49748744,100, 100,100,100,100,100,71.35802469,10.12345679)) {\n  # Use the Tanzanian (Killeen et al percentage in bed if an alternative has not been specified)  \n\n    library(ggplot2)\n  hour <- as.POSIXct(strptime(c(\"2016-12-17 18:30\",\"2016-12-17 19:30\",\"2016-12-17 20:30\",\"2016-12-17 21:30\",\"2016-12-17 22:30\",\n                                \"2016-12-17 23:30\",\"2016-12-18 00:30\",\"2016-12-18 01:30\",\"2016-12-18 02:30\",\n                                \"2016-12-18 03:30\",\"2016-12-18 04:30\",\"2016-12-18 05:30\",\"2016-12-18 06:30\")\n                              ,format = \"%Y-%m-%d %H:%M\"))\n  Exposure_nonuser<- (Percent_in_bed*IndoorL + (100-Percent_in_bed)*OutdoorL)/100\n  Exposure_user<- (100-Percent_in_bed)*OutdoorL/100\n# Pii is the proportion of exposure averted by nets (if 100% protective)\n    Pii <- 1 - sum(Exposure_user, na.rm = TRUE)/sum(Exposure_nonuser, na.rm = TRUE)\n\n# set up arrays for plotting  \n  Sampling_Location <- c(rep('Indoor', times=13),rep('Outdoor', times=13))\n  Use_status <- c(rep('Net user', times=13),rep('Non-user', times=13))\n  Exposure <- c(Exposure_user,Exposure_nonuser)\n  Human_landing <- c(IndoorL, OutdoorL)\n  time <- c(hour,hour)\n  Activity_cycle <- data.frame(hour, Percent_in_bed)\n  NetEffect <-data.frame(required_species,time,Exposure ,Use_status)\n  BitingCycle <-data.frame(required_species,time,Human_landing ,Sampling_Location)\n  library(scales)\n  \n  ActivityCycle_time <- ggplot(Activity_cycle, aes(y = Percent_in_bed, x = hour)) +\n    geom_line()+ \n    ylab(\"Percentage of population in sleeping spaces\")+\n    xlab(\"Time\")+\n    theme(axis.text.x = element_text(size = rel(2.0)))+\n    theme(axis.text.y = element_text(size = rel(2.0)))+\n    theme(axis.title.x = element_text(size = rel(2.0)))+\n    theme(axis.title.y = element_text(size = rel(2.0)))\n    #ggsave(filename=paste0('../',species_folder,'/ActivityCycle_time.png'),plot=ActivityCycle_time)\n    #write.table(Activity_cycle,file=paste0('../',species_folder,'/ActivityCycle_time.csv'))\n    \n  BitingCycle_time <- ggplot(BitingCycle, aes(y = Human_landing, x = time, color = Sampling_Location)) +\n    scale_y_continuous(limits=c(0,max(BitingCycle$Human_landing, na.rm = FALSE)))+\n    geom_point()+\n    geom_smooth(method = \"lm\", formula = y ~ splines::bs(x, 3), se = FALSE)+\n    ylab(\"Relative biting rate\")+\n    xlab(\"Time\")+\n    scale_colour_discrete(name=required_species)+ #previously said \"Sampling\\nlocation\" \n    theme(axis.text.x = element_text(size = rel(2.0)))+\n    theme(axis.text.y = element_text(size = rel(2.0)))+\n    theme(axis.title.x = element_text(size = rel(2.0)))+\n    theme(axis.title.y = element_text(size = rel(2.0)))+\n    #theme(legend.justification = 'left', legend.position=c(0.0,0.1))+\n    theme(legend.justification = 'left', legend.position='right')+\n    theme(legend.title = element_text(size = rel(2.0)))+\n    theme(legend.text = element_text(size = rel(1.3)))\n    #ggsave(filename=paste0('../',species_folder,'/BitingCycle_time.png'),plot=BitingCycle_time )\n    #write.table(BitingCycle,file=paste0('../',species_folder,'/BitingCycle_time.csv'))\n  \n   \n  NetEffect_time <- ggplot(NetEffect, aes(y = Exposure, x = time, color = Use_status)) +\n    geom_line()+\n    xlab(\"Time\")+\n    ylab(\"Exposure (bites per hour)\")+\n    scale_colour_discrete(name=paste(\"Bednet\\nstatus\\n(\",required_species,\")\"))+\n    theme(axis.text.x = element_text(size = rel(2.0)))+\n    theme(axis.text.y = element_text(size = rel(2.0)))+\n    theme(axis.title.x = element_text(size = rel(2.0)))+\n    theme(axis.title.y = element_text(size = rel(2.0)))+\n    theme(legend.justification = 'left', legend.position=c(0.7,0.8))+\n    theme(legend.title = element_text(size = rel(2.0)))+\n    theme(legend.text = element_text(size = rel(1.3)))\n    #ggsave(filename=paste0('../',species_folder,'/NetEffect_time.png'),plot=NetEffect_time)\n    #write.table(NetEffect,file=paste0('../',species_folder,'/NetEffect_time.csv'))\n    \n  return(Pii)\n}",
    "created" : 1634629135783.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "532631217",
    "id" : "452F1D86",
    "lastKnownWriteTime" : 1583612100,
    "last_content_update" : 1583612100,
    "path" : "~/Documents/GitRepos/anophelesmodel2/dev_AnophelesModel/base/calculate_Pii.r",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}